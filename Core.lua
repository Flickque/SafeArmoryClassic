SafeArmory=LibStub("AceAddon-3.0"):NewAddon("SafeArmoryClassic","AceConsole-3.0")local a=LibStub("AceLocale-3.0"):GetLocale("SafeArmoryClassic",true)local b=SafeArmory;b.L=a;b.ADDON_NAME="SafeArmoryClassic"local c=LibStub("json.lua")local d=LibStub("LibCopyPaste-1.0")local e=LibStub("LibDeflate")local f=LibStub("LibProfessions-1.0")local g=LibStub("AceDB-3.0")b.LibDeflate=e;b.LibProfessions=f;b.ldb=LibStub("LibDataBroker-1.1"):NewDataObject(b.ADDON_NAME,{type="launcher",text="SafeArmory",icon="Interface\\AddOns\\"..b.ADDON_NAME.."\\images\\icon",OnClick=function(self,h,i)if h=="LeftButton"then b:Export()elseif h=="RightButton"then b:Export()end end,OnTooltipShow=function(j)j:AddLine(b.L.title,1,1,1)j:AddLine(b.L.notice)j:AddLine(b.L.click)end})b.icon=LibStub("LibDBIcon-1.0")local k={profile={minimap={hide=false,minimapPos=142}}}function b:OnInitialize()SafeArmoryClassicData={data=nil,count=nil}self.db=g:New("SafeArmoryClassicDB",k,true)b.icon:Register(b.ADDON_NAME,b.ldb,self.db.profile.minimap)end;function b:Export()seterrorhandler(print)b:Copy(b:Collect())end;function b:Collect()b.dataCount=0;local l=b:GetAllData()local m=b:CountData(l)local n=GetServerTime()local o=0x8219C+n/2;o=math.floor(o)local p=b:CompressData(tostring(n))local q=b:first(n)local r=b:last(n)local s=b:CompressData(b:ToJSON(l))local t=string.format("%s:%s:%s:%s:%s",n,q,s,r,m)SafeArmoryClassicData={data=t,count=m}return t end;function b:ToJSON(l)l=c.encode(l)return l end;function b:CompressData(l)l=e:CompressDeflate(l)l=e:EncodeForPrint(l)return l end;function b:Copy(u)d:Copy("SafeArmoryClassic",u)end;function b:SlashCommand(v)b:Collect()end;b:RegisterChatCommand("safearmory","SlashCommand")b:RegisterChatCommand("sa","SlashCommand")print(a.title)print(a.welcome)print(a.notice)